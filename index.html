<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>McKinney Trend Command Center</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter+Tight:ital,wght@0,100..900;1,100..900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

<style>
body {
  background: #fff;
  color: #231f20;
  font-family: "Inter", sans-serif;
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
header {
  border-bottom: 2px solid #ccc;
  display: flex;
  align-items: center;
  height: 50px;
  padding: 10px 20px;
  flex-shrink: 0;
}
.app-title {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 300px;
}
h1, h2 { margin: 0; color: #b61214; }
h1 { font-weight: 600; }
h2 { font-weight: 500; }

main {
  display: flex;
  flex: 1;
  overflow: hidden;
}

nav {
  border-right: 2px solid #ccc;
  padding: 20px;
  width: 300px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  flex-shrink: 0;
}

.nav-title {
  text-transform: uppercase;
  font-size: 12px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 5px;
}

.active {
  background: #e0dcd3;
  border-radius: 5px;
}

.live-feed {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin: 20px 40px;
  max-width: 600px;
  overflow: hidden;
}

.container {
  flex: 1;
  overflow-y: auto;
  scrollbar-width: none;
}
.container::-webkit-scrollbar { display: none; }

.trend {
  display: flex;
  gap: 15px;
  background: #fff5e6;
  border-radius: 5px;
  padding: 15px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
}

.trend img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 5px;
  margin-top: 35px;
}

.trend-name { font-weight: 700; margin: 0 0 10px; }

.type {
  background: #520c00;
  color: #f2f0e9;
  padding: 2px 10px;
  border-radius: 5px;
  width: max-content;
}

#types-count {
  background: #520c00;
  color: #f2f0e9;
  padding: 15px;
  border-radius: 5px;
  overflow-y: auto;
}

.type-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<header>
  <div class="app-title">
    <h1>Social Radar</h1>
  </div>
  <h2>McKinney Trend Command Center</h2>
</header>

<main>

<nav>
  <p class="nav-title">Main</p>
  <div class="nav-item active">Live Feed</div>
</nav>

<div class="live-feed">
  <h3 id="live-feed-title">Live Feed</h3>
  <div class="container" id="trends">Loadingâ€¦</div>
</div>

<div class="live-feed">
  <h3>Top Types</h3>
  <div id="types-count">Loadingâ€¦</div>
</div>

</main>

<script>
let allTrends = [];
let currentIndex = 0;        // dataset index (loops)
let totalDisplayed = 0;     // fake overall count (never resets)
let typeCounts = {};

const PRELOAD_COUNT = 200;
const totalTimeMinutes = 30;
const batchInterval = (totalTimeMinutes * 60 * 1000) / 991;

const container = document.getElementById('trends');
const liveFeedHeader = document.getElementById('live-feed-title');

let userScrolled = false;

container.addEventListener('scroll', () => {
  const atBottom =
    container.scrollTop + container.clientHeight >= container.scrollHeight - 5;
  userScrolled = !atBottom;
});

fetch('data/trends_data.json')
  .then(r => r.json())
  .then(data => {
    allTrends = data;
    container.innerHTML = '';
    preloadTrends();
    startLiveFeed();
  });

function addTrend(trend, animate = true) {
  const div = document.createElement('div');
  div.className = 'trend';

  if (animate) {
    div.style.opacity = '0';
    div.style.transition = 'opacity 0.3s';
  }

  div.innerHTML = `
    <img src="data/${trend.trend_image || 'https://via.placeholder.com/80'}">
    <div>
      <p class="trend-name">${trend.name || 'No name'}</p>
      <p>${trend.trend_description || ''}</p>
      <p class="type">${trend.type || 'No type'}</p>
    </div>
  `;

  container.appendChild(div);

  if (animate) {
    requestAnimationFrame(() => div.style.opacity = '1');
  }

  const t = trend.type || 'No type';
  typeCounts[t] = (typeCounts[t] || 0) + 1;
}

function preloadTrends() {
  for (let i = 0; i < PRELOAD_COUNT && i < allTrends.length; i++) {
    addTrend(allTrends[i], false);
    currentIndex++;
    totalDisplayed++;
  }

  container.scrollTop = container.scrollHeight;
  liveFeedHeader.textContent = `Live Feed (${totalDisplayed})`;
  updateTopTypes();
}

function startLiveFeed() {
  function tick() {
    if (currentIndex >= allTrends.length) {
      currentIndex = 0; // ðŸ” loop dataset only
    }

    addTrend(allTrends[currentIndex], true);
    currentIndex++;
    totalDisplayed++;

    liveFeedHeader.textContent = `Live Feed (${totalDisplayed})`;
    updateTopTypes();

    if (!userScrolled) {
      container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
    }

    const delay = batchInterval + (Math.random() * 3000 - 500);
    setTimeout(tick, Math.max(100, delay));
  }

  tick();
}

function updateTopTypes() {
  const box = document.getElementById('types-count');
  box.innerHTML = '';

  Object.entries(typeCounts)
    .sort((a, b) => b[1] - a[1])
    .forEach(([type, count]) => {
      const p = document.createElement('p');
      p.className = 'type-label';
      p.innerHTML = `<span>${type}</span><span>${count}</span>`;
      box.appendChild(p);
    });
}
</script>

</body>
</html>
